<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="css/bootstrap.min.css">  
	<script type="text/javascript">
	if (navigator.userAgent.match(/Android/i)
	  || navigator.userAgent.match(/webOS/i)
	  || navigator.userAgent.match(/iPhone/i)
	  || navigator.userAgent.match(/iPad/i)
	  || navigator.userAgent.match(/iPod/i)
	  || navigator.userAgent.match(/BlackBerry/i)
	  || navigator.userAgent.match(/Windows Phone/i))
		document.write('<meta name="viewport" content="width=500, user-scalable=yes" />');
	</script>
	<title>Brave Frontier Player EXP Calculator</title>
</head>
<body>
	<br>
	<br>
	Your current level (51 to 299): <input type="text" id="currentLevel" value="0"><br>
	<br>
	Your current EXP: <input type="text" id="currentEXP" value="0"> (leave 0 if you want to assume you just leveled up and have 0 EXP)<br>
	<br>
	Your goal is to reach level <input type="text" id="goalLevel"> (max 300)<br>
	<br>
	You have a quest which gives <input type="text" id="questEXP" value="16600"> EXP.<br>
	<br>
	<br>
	<input type="Button" value="Calculate Total EXP" onclick="calculate()">
	<br>
	<br>
	<div id="result" style="color:blue; font-size: 24px;">
	</div>
	<input type="button" id="showEXPListButton" value="Show Details" style="visibility:hidden" onclick="showEXPTable()">
	<br>
	<div id="EXPTable">
	</div>
	<br>
	<br>
	<br>
	<div id="nextStep" style="visibility:hidden">
		<input type="hidden" id="goalEXPValue" value="0">		
		Now the quest requires <input type="text" id="questEnergy" value="25"> energy, and it took you <input type="text" id="questTime" value="10"> minutes to finish the quest.<br>
		<br>
		Assuming 3 minute per energy, full energy at your current level, 10 minutes to finish a quest, and factoring in energy refill each level up...<br>
		<br>
		<input type="Button" value="Calculate time needed" onclick="calculateTime()"><br>
		<div id="resultEnergy" style="color:blue; font-size: 24px;"></div>
		<div id="resultEnergyDetails"></div>
	</div>
	<br>
	<br>
	For references: <br>
	St. Lamia - St. Lamia Palace - Fourfold Pillar: 10 energy, 2600 EXP (double EXP event: 5200)<br>
	Lanara - Alnakeid Castle - Call of the Storm: 23 energy, 7200 EXP<br>
	Atharva - Crystal Palace - Changing the World: 25 energy, 8300 EXP (double EXP event: 16600 EXP)<br>
	Celgrad - Soaring Tree Tower - Tested Power: 25 energy, 8400 EXP (double EXP event: 16800 EXP)<br>
	Monday Vortex - Soul Sanctuary Lv. 4: 30 energy (half energy event: 15 energy), 13,200 EXP<br>
	<br>



	<!--
	My to-do list: count how many energy needed, and with 3 minute per energy, how long it gonna take (this must consider energy refill from leveling up)
	-->



	<script type="text/javascript">

	/* 
		function calculate(): Just to calculate total EXP needed from the current level to reach goal level.
		
		The EXP formula for each level is pretty simple:
		BASE_EXP + (n - BASE_LV) * (NEXT_EXP - BASE_EXP) + ((n - (BASE_LV + 1) + 1) * (n - (BASE_LV + 1)) / 2) * INCREMENT
		Level 51-58 follows the same constants.
		Level 58-255 follows a different constants.
		Level 255 and above (until when, I didn't know) follows an even different constants.
			
		To calculate from level 51 to level 58 you just need the same set of constants (NEXT_EXP, BASE_EXP, INCREMENT, and BASE_LV). But to calculate beyond level 58 you need a different constants (a new NEXT_EXP, BASE_EXP, INCREMENT, and BASE_LV) otherwise the result will be incorrect. The same goes with level 58 to level 255. Beyond level 255, the calculation uses a new and different constants than before.
	*/

	function calculate() {
			
		var currentLevel = parseInt(document.getElementById("currentLevel").value);
		var currentEXP = parseInt(document.getElementById("currentEXP").value);
		var goalLevel = parseInt(document.getElementById("goalLevel").value);
		var questEXP = parseInt(document.getElementById("questEXP").value);
			
		if (currentLevel != "0" && goalLevel != "0" && questEXP != "0") {		
			
			if (goalLevel < currentLevel) {
				document.getElementById("result").innerHTML = "Invalid: You can't level down.";
			}
			else if (currentLevel < 51 || currentLevel > 299 || goalLevel < 51 || goalLevel > 300) {
				document.getElementById("result").innerHTML = "Can only calculate from level 51 to 300.";
			}		
			else {
				
				function f(n) {
					if (n >= 51 && n < 58) {
						BASE_EXP = 19958;
						BASE_LV = 51;
						NEXT_EXP = 20636;
						INCREMENT = 6
						return BASE_EXP + (n - BASE_LV) * (NEXT_EXP - BASE_EXP) + ((n - (BASE_LV + 1) + 1) * (n - (BASE_LV + 1)) / 2) * INCREMENT
					}
					else if (n >= 58 && n < 255) {
						BASE_EXP = 24830
						BASE_LV = 58
						NEXT_EXP = 25580
						INCREMENT = 2
						return BASE_EXP + (n - BASE_LV) * (NEXT_EXP - BASE_EXP) + ((n - (BASE_LV + 1) + 1) * (n - (BASE_LV + 1)) / 2) * INCREMENT
					}
					else {
						BASE_EXP = 212713
						BASE_LV = 255
						NEXT_EXP = 214114
						INCREMENT = 3
						return BASE_EXP + (n - BASE_LV) * (NEXT_EXP - BASE_EXP) + ((n - (BASE_LV + 1) + 1) * (n - (BASE_LV + 1)) / 2) * INCREMENT
					}
				}
				
				goalEXP = 0;
				
				for (i = currentLevel; i < goalLevel; i++) {
					goalEXP = goalEXP + f(i);
				}				
				
				if (currentEXP == 0) {
					questCount = (goalEXP % questEXP == 0) ? Math.floor(goalEXP / questEXP) : Math.floor(goalEXP / questEXP)+ 1;
				
					document.getElementById("result").innerHTML = "At level " + currentLevel + " you have to run the quest " + questCount + " times " + " to reach level " + goalLevel + ".";
				}
				else {
					goalEXP = goalEXP - currentEXP;
					questCount = (goalEXP % questEXP == 0) ? Math.floor(goalEXP / questEXP) : Math.floor(goalEXP / questEXP)+ 1;
				
					document.getElementById("result").innerHTML = "At level " + currentLevel + " with " + (f(currentLevel) - currentEXP) + " EXP left to level up, you have to run the quest " + questCount + " times " + " to reach level " + goalLevel + ".";
				}
				
				document.getElementById("showEXPListButton").style.visibility = "visible";
				document.getElementById("nextStep").style.visibility = "visible";
				document.getElementById("goalEXPValue").value = goalEXP;
			}
		}
		
	}

	function showEXPTable() {
		function f(n) {
			if (n >= 51 && n < 58) {
				var BASE_EXP = 19958;
				var BASE_LV = 51;
				var NEXT_EXP = 20636;
				var INCREMENT = 6
				return BASE_EXP + (n - BASE_LV) * (NEXT_EXP - BASE_EXP) + ((n - (BASE_LV + 1) + 1) * (n - (BASE_LV + 1)) / 2) * INCREMENT
			}
			else if (n >= 58 && n < 255) {
				var BASE_EXP = 24830
				var BASE_LV = 58
				var NEXT_EXP = 25580
				var INCREMENT = 2
				return BASE_EXP + (n - BASE_LV) * (NEXT_EXP - BASE_EXP) + ((n - (BASE_LV + 1) + 1) * (n - (BASE_LV + 1)) / 2) * INCREMENT
			}
			else {
				var BASE_EXP = 212713
				var BASE_LV = 255
				var NEXT_EXP = 214114
				var INCREMENT = 3
				return BASE_EXP + (n - BASE_LV) * (NEXT_EXP - BASE_EXP) + ((n - (BASE_LV + 1) + 1) * (n - (BASE_LV + 1)) / 2) * INCREMENT
			}
		}
		
		resultText = "";
		totalEXP = 0;
		
		var currentLevel = parseInt(document.getElementById("currentLevel").value);		
		var goalLevel = parseInt(document.getElementById("goalLevel").value);
		
		for (i = currentLevel; i < goalLevel; i++) {
			resultText = resultText + "Level " + i + ": " + f(i) + " EXP required to level up." + "<br>";
			totalEXP = parseInt(totalEXP) + f(i);
		}
		
		document.getElementById("EXPTable").innerHTML = resultText;
		document.getElementById("showEXPListButton").value = "Hide Details";
		document.getElementById("showEXPListButton").onclick = function() { hideEXPTable(); };
	}

	function hideEXPTable() {
		document.getElementById("EXPTable").innerHTML = "";
		document.getElementById("showEXPListButton").value = "Show Details";
		document.getElementById("showEXPListButton").onclick = function() { showEXPTable(); };
	}

	function calculateTime() {
	
		var currentLevel = parseInt(document.getElementById("currentLevel").value);
		var currentEXP = parseInt(document.getElementById("currentEXP").value);
		var goalLevel = parseInt(document.getElementById("goalLevel").value);
		var questEXP = parseInt(document.getElementById("questEXP").value);
		var questEnergy = parseInt(document.getElementById("questEnergy").value);
		var questTime = parseInt(document.getElementById("questTime").value);
	
		function f(n) {
			if (n >= 51 && n < 58) {
				BASE_EXP = 19958;
				BASE_LV = 51;
				NEXT_EXP = 20636;
				INCREMENT = 6
				return BASE_EXP + (n - BASE_LV) * (NEXT_EXP - BASE_EXP) + ((n - (BASE_LV + 1) + 1) * (n - (BASE_LV + 1)) / 2) * INCREMENT
			}
			else if (n >= 58 && n < 255) {
				BASE_EXP = 24830
				BASE_LV = 58
				NEXT_EXP = 25580
				INCREMENT = 2
				return BASE_EXP + (n - BASE_LV) * (NEXT_EXP - BASE_EXP) + ((n - (BASE_LV + 1) + 1) * (n - (BASE_LV + 1)) / 2) * INCREMENT
			}
			else {
				BASE_EXP = 212713
				BASE_LV = 255
				NEXT_EXP = 214114
				INCREMENT = 3
				return BASE_EXP + (n - BASE_LV) * (NEXT_EXP - BASE_EXP) + ((n - (BASE_LV + 1) + 1) * (n - (BASE_LV + 1)) / 2) * INCREMENT
			}
		}
				
		function g(n) {
			if (n >= 51 && n < 83)
				return 52 + Math.floor((n - 51 + 1) / 3) + 5 * Math.floor((n - 46 + 1) / 10)
			if (n >= 83 && n < 101)
				return 78 + Math.floor((n - 83) / 2) + 5 * Math.floor((n - 83 + 8) / 10)
			if (n >= 101 && n < 152)
				return 97 + Math.floor((n - 101) / 3)
			if (n >= 152 && n < 251)
				return 115 + 2 * Math.floor((n - 152) / 3)
			else
				return 180 + Math.floor((n - 251) / 3)
		}		
		
		totalTime = 0;
		
		resultTextEnergy = "";
		
		for (i = currentLevel; i < goalLevel; i++) {		
			
			neededEXP                  = f(i) - currentEXP;		
			numberOfTimes              = Math.floor(neededEXP/questEXP) + 1;
			howManyQuestWithFullEnergy = Math.floor(g(i) / questEnergy);
			cutEXP                     = (questEXP * numberOfTimes) - neededEXP;
			
			runningQuestTime = 0;
			waitEnergyTime = 0;
			
			if (numberOfTimes - howManyQuestWithFullEnergy > 0) {
				
				waitEnergyTime = ((numberOfTimes - howManyQuestWithFullEnergy) * questEnergy - (g(i) % questEnergy)) * 3;
				
				waitTime = ((numberOfTimes - howManyQuestWithFullEnergy) * questEnergy - (g(i) % questEnergy)) * 3 - howManyQuestWithFullEnergy * questTime;
				
				if (waitTime > 0) {
					resultTextEnergy = resultTextEnergy + "Level " + i + " : " + g(i) + " energy with current EXP: " + currentEXP + " --- EXP to level up: " + neededEXP + ". You need to run the quest " + numberOfTimes + " times to level up. You can run the quest " + howManyQuestWithFullEnergy + " times (will take you " + (howManyQuestWithFullEnergy * questTime) + " minutes) before you have to wait a total of " + waitTime + " minutes to do " + (numberOfTimes - howManyQuestWithFullEnergy) + " more.<br>";
				}
				else {
					waitEnergyTime = 0;
					runningQuestTime = numberOfTimes * questTime;
					
					resultTextEnergy = resultTextEnergy + "Level " + i + " : " + g(i) + " energy with current EXP: " + currentEXP + " --- EXP to level up: " + neededEXP + ". You need to run the quest " + numberOfTimes + " times. You can run the quest " + Math.floor(g(i) / questEnergy) + " times with that full energy (will take you " + (howManyQuestWithFullEnergy * questTime) + " minutes) and when you're done, you will have regenerated " + Math.floor((howManyQuestWithFullEnergy * questTime)/3) + " more energy to run the quest " + (numberOfTimes - howManyQuestWithFullEnergy) + " more times to level up.<br>";
				}
				
			}
			else {				
				runningQuestTime = numberOfTimes * questTime;	
				resultTextEnergy = resultTextEnergy + "Level " + i + " : " + g(i) + " energy with current EXP: " + currentEXP + " --- EXP to level up: " + neededEXP + ". You need to run the quest " + numberOfTimes + " times to level up.<br>";
			}
			
			totalTime = totalTime + runningQuestTime + waitEnergyTime;
			
			currentEXP = cutEXP;
		}				
				
		totalTimeText = "";
		
		if (totalTime >= 1440) {
			totalTimeText = Math.floor(totalTime/1440) + " day(s)";
			totalTime = totalTime % 1440;
			if (totalTime >= 60) {
				totalTimeText = totalTimeText + ", " + Math.floor(totalTime/60) + " hour(s)";
				totalTime = totalTime % 60;
				if (totalTime > 0) {
					totalTimeText = totalTimeText + ", " + totalTime + " minute(s)";
				}
			}				
		}
		else if (totalTime >= 60) {
			totalTimeText = Math.floor(totalTime/60) + " hour(s)";
			totalTime = totalTime % 60;
			if (totalTime > 0) {
				totalTimeText = totalTimeText + ", " + totalTime + " minute(s)";
			}
		}
		else {
			totalTimeText = totalTime + " minutes";
		}
		
		document.getElementById("resultEnergy").innerHTML = "About " + totalTimeText + "<br>";
		document.getElementById("resultEnergyDetails").innerHTML = resultTextEnergy;
	}
	</script>

	<!-- 
		Hello there, glad to see you looking at the algorithm. Took me days to write this whole thing.
		
		But even so, feel free to copy paste the script/claim this as your own/make changes etc anywhere you like. I only did this for fun so go wild. 
		
		find me on 
			reddit: /u/blackrobe199 
			appinvasion/BFF: blackrobe
	-->
</body>
</html>